<DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <tittle>My book api</title>
        
        <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<style>
    #color1 {
        background-color: #009688;
        color: white;
    }  
    
    #color2 {
       background-color: #673ab7;
/*       color: white;*/

    }   
    
    #color3 {
        background-color: #ff9800;
        color: white;

    }   
    
    #color4 {
        background-color: #00bcd4;
        color: white;

    } 
    
    li {
        font-family: calibri;
        font-size: 17pt;        
    }
</style>
        
<script>
window.addEventListener('load', function() {   
    
    
let tryAgain = document.getElementById("tryAgain");
    
//    *********** buttons *********************************
let addbtn = document.getElementById("addbtn");
let viewlistbtn = document.getElementById("viewlistbtn");   
let changebookbtn = document.getElementById("changebookbtn");   
let deletebtn = document.getElementById("deletebtn");
    
//    *********** inputs ******************************
let authorinput = document.getElementById("authorinput");   
let titleinput = document.getElementById("titleinput");
//    **********************************************
var booklist = document.getElementById("booklist"); 
//    **********************************************
let booknumber = document.getElementById("booknumber");
let booktitle = document.getElementById("booktitle");   
let bookauthor = document.getElementById("bookauthor"); 
//    **********************************************   
let bookid = document.getElementById("bookid"); 
    
var olList = document.getElementById("olList");    
 

  
//************** view list ********************* 
let reloadPage = function(){
    let url = "https://www.forverkliga.se/JavaScript/api/crud.php?op=select&key=1WA18";
    
    let req = new XMLHttpRequest();
        req.open('get', url);
        req.onreadystatechange = function() {
            if(req.status == 200 && req.readyState == 4) {
                let json = JSON.parse(req.responseText);
               
                if(json.status === 'error'){
                    reloadPage();
                }

//********************************************************************                
                else {
                    let bookArray = json.data;
                    olList.innerHTML = "";
                    console.log(bookArray);
                      for(let i=0; i< bookArray.length; i++){                          
                            
                            let li = document.createElement('li');
                            li.innerHTML = '"' + bookArray[i].title + '"' +", "+ bookArray[i].author + ", ID: " + bookArray[i].id;
                            olList.appendChild(li);
                        }
                      }                 
                    }
                  }
        
                
req.send(); 
 
};
viewlistbtn.addEventListener('click', reloadPage);
//  *********** add book *************    

    
 let pushBook = function() {
     
    let titleToPush = titleinput.value;
    let authorToPush = authorinput.value;

     
     let url = "https://www.forverkliga.se/JavaScript/api/crud.php?op=insert&key=1WA18&title=" + titleToPush +"&author=" + authorToPush;
    
    
     let req = new XMLHttpRequest();
        req.open('post', url);
        req.onreadystatechange = function() {
            if(req.status == 200 && req.readyState == 4) {
                let json = JSON.parse(req.responseText);
                
                if(json.status === 'error'){
                    pushBook();
                }
             titleToPush.innerHTML = "";
            authorToPush.innerHTML = "";

                    }
        }
                
req.send(); 
     
};

addbtn.addEventListener('click', pushBook);    
    
//*************delete book**************************************
    
let deleteBook = function() {
     
    let idToPush = bookid.value;

     
     let url = "https://www.forverkliga.se/JavaScript/api/crud.php?op=delete&key=1WA18&id=" + idToPush;
    
    
     let req = new XMLHttpRequest();
        req.open('post', url);
        req.onreadystatechange = function() {
            if(req.status == 200 && req.readyState == 4) {
                let json = JSON.parse(req.responseText);
                
                if(json.status === 'error'){
                    deleteBook();
                    
                }              
             

                    }
        }
                
req.send(); 
     
}
deletebtn.addEventListener('click', deleteBook);
    
    
//*********************make changes**************************  
let modifyBook = function() {
     
    let booknumberC = booknumber.value;
    let booktitleC = booktitle.value;
    let bookauthorC = bookauthor.value;

     
     let url = "https://www.forverkliga.se/JavaScript/api/crud.php?op=update&key=1WA18&id=" + booknumberC + "&title=" + booktitleC + "&author=" + bookauthorC;
    
    
     let req = new XMLHttpRequest();
        req.open('post', url);
        req.onreadystatechange = function() {
            if(req.status == 200 && req.readyState == 4) {
                let json = JSON.parse(req.responseText);
                if(json.status === 'error'){
                    modifyBook();
                    
                }
                
        //    console.log(json.status);
             

                    }
        }
                
req.send(); 
     
}
changebookbtn.addEventListener('click', modifyBook);
       
    
    
    
}); // Windows load

</script>
    </head>
    
    <body>
        <div class="container">
            
<!--    ************ add books *************-->
            <div class="jumbotron" id="color1">
                <h1>Add book</h1>
                
                <form>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                      <input id="authorinput" type="text" class="form-control" name="authorinput" placeholder="author">
                    </div>
                    <div class="input-group">
                      <span class="input-group-addon"><i class="glyphicon glyphicon-book"></i></span>
                      <input id="titleinput" type="text" class="form-control" name="titleinput" placeholder="title">
                    </div>
                    <button type="button" class="btn btn-warning" id="addbtn">Add book</button>
<!--                <div class="alert alert-danger" id="tryAgain"></div>-->
                </form>

            </div>
       
<!--    ************ view books *************-->            
             <div class="jumbotron" id="color2">
                <h1>View books</h1>
                <button type="button" class="btn btn-warning" id="viewlistbtn">View my book-list</button>
                 <div class="well well-lg" id= "booklist"><ol id="olList"></ol></div>

            </div>
            
<!--    ************ make changes *************-->            
             <div class="jumbotron" id="color3">
                <h1>Make changes</h1>
                <form>
                    <div class="input-group">
                      <input id="booknumber" type="text" class="form-control" name="booknumber" placeholder="Book ID">
                    </div>
                    <div class="input-group">
                      <input id="booktitle" type="text" class="form-control" name="booktitle" placeholder="Book title">
                    </div>
                    
                    <div class="input-group">
                      <input id="bookauthor" type="text" class="form-control" name="bookauthor" placeholder="Book author">
                    </div>
                     <button type="button" class="btn btn-warning" id="changebookbtn">Change book</button>
                </form>

            </div>
            
 <!--    ************ delete book *************-->           
            <div class="jumbotron" id="color4">
                <h1>Delete a book</h1>
                <form>
                    <div class="input-group">
                      <input id="bookid" type="text" class="form-control" name="bookid" placeholder="Book id">
                    </div>
                    <button type="button" class="btn btn-warning" id  ="deletebtn">Delete book</button>

                </form>
            </div>
        
        </div>
    </body>